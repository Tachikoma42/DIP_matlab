% 2. ZigIDCT.m 
function [I,e,rmse1]=ZigIDCT(oldbuf,dctfre,DCTch,n) 
    %oldbuf:åŽŸå§‹å›¾åƒ?æ•°æ?® 
    %dctfre:DCTç³»æ•°çŸ©é˜µ 
    %DCTch:æ¯?ä¸ªåˆ†å?—ä¸­éœ€è¦?ä¿?ç•™çš„DCTç³»æ•°ä¸ªæ•° 
    %n:åˆ†å?—çš„å¤§å°? 
    %e:åŽŸå›¾åƒ?ä¸Žä¿?ç•™éƒ¨åˆ†DCTç³»æ•°å?Žçš„é‡?å»ºå›¾åƒ?ä¹‹é—´çš„è¯¯å·®çŸ©é˜µ 
    % æŒ‰Zig-Zagæ‰«æ??é¡ºåº?ï¼Œæ ¹æ?®DCTchå?‚æ•°ï¼Œå?ªä¿?ç•™64ä¸ª 
    % DCTç³»æ•°ä¸­çš„å‰?DCTchä¸ªç³»æ•°ï¼Œå¯¹ä¿®æ”¹å?Žçš„DCTç³»æ•°ç”¨é€†DCTå?˜æ?¢é‡?å»ºå›¾åƒ?ï¼Œå¾—åˆ°DCTå?˜ 
    % æ?¢çš„åŽ‹ç¼©å›¾åƒ?ã€‚è®¡ç®—é‡?å»ºå›¾åƒ?çš„å?‡æ–¹æ ¹è¯¯å·®RMSE ï¼›æ˜¾ç¤ºè¯¯å·®å›¾åƒ?å’Œè¯¯å·®ç›´æ–¹å›¾ã€‚ 
zigzag = [
    01 02 06 07 15 16 28 29
    03 05  08 14 17 27 30 43
    04 09 13 18 26 31 42 44
    10 12 19 25 32 41 45 54
    11 20 24 33 40 46 53 55
    21 23 34 39 47 52 56 61
    22 35 38 48 51 57 60 62
    36 37 49 50 58 59 63 64
    ];%è®¾ç½®zæ‰«æ??é¡ºåº?
    maskbuf=zigzag<=DCTch;
    %æ ¹æ?®å½“å‰?DCTchå€¼å¾—åˆ°â€œZâ€?å­—æ‰«æ??çš„é€»è¾‘å€¼,maskä¸ºlogicç±»åž‹ 
    %å¯¹ä¿®æ”¹å?Žçš„DCTç³»æ•°ç”¨é€†DCTå?˜æ?¢é‡?å»ºå›¾åƒ?ï¼Œå¾—åˆ°DCTå?˜æ?¢çš„åŽ‹ç¼©å›¾åƒ? 
    D=dctmtx(n);
    I=blkproc(dctfre,[n n],'P1*(x.*P2)*P3',D',maskbuf,D);
    %Iä¸ºé‡?å»ºçš„åŽ‹ç¼©å›¾åƒ? çŸ©é˜µ 
    e=oldbuf-I;
    %e:åŽŸå›¾åƒ?ä¸Žä¿?ç•™éƒ¨åˆ†DCTç³»æ•°å?Žçš„é‡?å»ºå›¾åƒ?ä¹‹é—´çš„è¯¯å·®çŸ©é˜µ 
    I=I+128;
    rmse1=RMSE(e);
end 
